<!DOCTYPE html>
<html>
<head>
    <title>Create Google Slides from Template3</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <h1>Create Google Slides from Template3</h1>
    <form id="input-form">
        <label for="word">Enter a word:</label><br>
        <input type="text" id="word" name="word"><br><br>
        <input type="submit" value="Submit">
    </form>
    <div id="g_id_onload"
         data-client_id="168113913917-15vs65ov3fb7hjadf55672gm6nsuf0sm.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="sign_in_with"
         data-size="large"
         data-logo_alignment="left">
    </div>

    <script>
        const CLIENT_ID = '168113913917-15vs65ov3fb7hjadf55672gm6nsuf0sm.apps.googleusercontent.com';
        const DISCOVERY_DOCS = ["https://slides.googleapis.com/$discovery/rest?version=v1"];
        const SCOPES = "https://www.googleapis.com/auth/presentations https://www.googleapis.com/auth/drive.file";

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        document.getElementById('input-form').style.display = 'none';

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                discoveryDocs: DISCOVERY_DOCS,
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('input-form').style.display = 'block';
                document.querySelector('.g_id_signin').style.display = 'none';
            }
        }

        function handleCredentialResponse(response) {
            if (response.credential) {
                gapi.client.setToken({ access_token: response.credential });
                document.getElementById('input-form').style.display = 'block';
            }
        }

        document.getElementById('input-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const word = document.getElementById('word').value;
            await tokenClient.requestAccessToken({ prompt: '' });
            createAndPopulateSlide(word);
        });

        async function createAndPopulateSlide(word) {
            const templatePresentationId = '1RfpmUhs1Rcv1LpmikmbhQYlFKtuFsKuZq13bEpFHgEM';
            const requests = [
                {
                    duplicateObject: {
                        objectId: 'g2f0197cd1a9_0_79',
                        objectIds: {
                            newObjectId: 'new_slide_id'
                        }
                    }
                },
                {
                    insertText: {
                        objectId: 'new_slide_id',
                        insertionIndex: 0,
                        text: word
                    }
                }
            ];

            try {
                const createResponse = await gapi.client.slides.presentations.create({
                    resource: { title: 'New Presentation from Template' }
                });
                const newPresentationId = createResponse.result.presentationId;
                await gapi.client.slides.presentations.batchUpdate({
                    presentationId: newPresentationId,
                    resource: { requests: requests }
                });
                const url = `https://docs.google.com/presentation/d/${newPresentationId}`;
                window.location.href = url;
            } catch (err) {
                console.error('Error creating or updating presentation:', err);
            }
        }

        window.onload = function() {
            gapiLoaded();
            gisLoaded();
        };
    </script>
</body>
</html>
